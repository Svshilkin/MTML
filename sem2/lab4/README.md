# Работа с временным рядом
#### Данные отображают цены на акции компании BAC на момент их закрытия.

### Загрузка данных

!!!1

### Построим график временного ряда

!!!2

График показывает, что цены на акции BAC были в основном стабильны в начале периода. Однако, существует большое количество короткосрочных колебаний цен, которые не подчиняются общему тренду и вызваны внешними факторами, такими как новости, экономические изменения и т.д.

На графике цен на момент закрытия акций компании BAC, представленном выше, можно наблюдать общий тренд цен на протяжении всего периода.

#### Посмотрим на скользящее среднее

!!!3

### Тест Дикки-Фуллера 

Проверим на уровне значимости 0.05

!!!4

!!!5

Results of Dickey-Fuller Test:
p-value = 0.4449. The series is likely non-stationary.
Test Statistic                  -1.673299
p-value                          0.444919
#Lags Used                       0.000000
Number of Observations Used    567.000000
Critical Value (1%)             -3.441936
Critical Value (5%)             -2.866651
Critical Value (10%)            -2.569492
dtype: float64

На основании теста Dickey-Fuller, можно сделать вывод о том, что временной ряд не является стационарным. Это подтверждается значением p-value, превышающим уровень значимости 0.05, и недостаточным значением тестовой статистики для отклонения от нулевой гипотезы о нестационарности ряда.

### Методология Бокса-Дженкинса.
#### ACF

!!!6

!!!7

#### PACF

!!!8

!!!9

Это означает, что на 50-ом лаге автокорреляционная функция (ACF) последующие лаги становятся значимыми. Из графика PACF (Partial Autocorrelation Function) можно сделать вывод, что после второго лага все последующие лаги не являются значимыми, т.е. корреляция становится незначительной.

Результаты построение PACF и ACF не удовлетворительны. Сложно определить примерные значения p,q для построения ARIMA-модели. Предлагается для начала избавится от трендовой зависимости

### Удаления линейной трендовой составляющей из временного ряда

!!!10

### Тест Дикки-Фуллера  без тренда

p-value = 0.1247. The series is likely non-stationary.

Хоть ряд и не является стационарным, результаты теста Дики-Фуллера показывают, что значение p-value уменьшилось. Это может свидетельствовать о том, что ряд стал более стационарным, чем раньше.

### Методология Бокса-Дженкинса без тренда

#### ACF

!!!11

!!!12

#### PACF

!!!13

!!!14

Зависимость цены акции от предыдущих значений снизилась, однако она все еще остается существенной.

### Разделяем на обучающую и тестовую выборки

Размер обучающей выборки: 510

Размер тестовой выборки: 58

!!!15

Исходя из полученных результатов, можно сделать вывод, что модель ARIMA(6,1,13), которая учитывает тренд, дает более точные прогнозы, чем модель ARIMA(6,0,5) без тренда. Это можно объяснить тем, что в исходных данных присутствует заметный тренд, и учет тренда позволяет лучше описать структуру временного ряда.

### Проверим модель на тестовой выборке

!!!16

### Построим прогноз

!!!17

Исходя из анализа графика, можно сделать вывод, что в будущем цены на акции компании WMT скорее всего будут понижаться.

### Построение моделей для прогноза по разным периодам

!!!18

Разделим исходные данные на 3 блока:

1) 2012.01.01 - 2015.10.14

2) 2015.10.14 - 2019.08.08

3) 2019.08.08 - н.в.

Из результатов моделирования видно, что лучшая модель на первом блоке данных имеет порядок (4,0,3) и достигает MAE на тренировочной выборке в размере 0.322, а на тестовой - 0.278. Лучшая модель на втором блоке данных имеет порядок (3,0,4) и достигает MAE на тренировочной выборке в размере 0.582, а на тестовой - 0.499. Лучшая модель на третьем блоке данных имеет порядок (4,0,2) и достигает MAE на тренировочной выборке в размере 1.127, а на тестовой - 1.109.

Модель с наименьшим значением MAE на тестовой выборке является наиболее предпочтительной для прогнозирования будущих значений. Следовательно, на основе результатов моделирования можно сделать вывод, что наиболее точная модель на тестовой выборке была построена на первом блоке данных и имеет порядок (4,0,3).




















